<div class="comments-container">
  <h2>Comments</h2>
  <ng-container *ngFor="let comment of comments; let i = index">
    <!-- Top-level comments -->
    <div *ngIf="!comment.parentID" class="comment-entry">
      <div class="user-info">
        <div class="user-id">User ID: {{ comment.charityHubUser?.id }}</div>
        <div *ngIf="editCommentId !== comment.id" class="comment-content">{{ comment.content }}</div>
        <div *ngIf="editCommentId === comment.id" class="edit-input-section">
          <input
            type="text"
            [(ngModel)]="editCommentContent[comment.id]"
            class="edit-input"
            placeholder="Edit your comment..."
            (keyup.enter)="updateComment(comment.id)"
          />
          <button (click)="updateComment(comment.id)" class="edit-save-button">Save</button>
        </div>
      </div>
      <div class="comment-actions">
        <button (click)="toggleReply(comment.id)" class="reply-button">Reply</button>
        <button (click)="deleteComment(comment.id)" class="delete-button">Delete</button>
        <button *ngIf="editCommentId !== comment.id" (click)="toggleEdit(comment.id)" class="edit-button">Edit</button>
      </div>
      <!-- Reply input -->
      <div *ngIf="showReply[comment.id]" class="reply-input-section">
        <input
          type="text"
          [(ngModel)]="newReply[comment.id]"
          name="replyInput{{ i }}"
          class="reply-input"
          placeholder="Write a reply..."
          (keyup.enter)="addReply(comment.id, newReply[comment.id])"
        />
        <button (click)="addReply(comment.id, newReply[comment.id])" class="reply-post-button">Post</button>
      </div>
      <!-- Replies section -->
      <div class="replies">
        <ng-container *ngFor="let reply of comments; let j = index">
          <div *ngIf="reply.parentID === comment.id" class="reply-entry">
            <div class="user-info">
              <div class="user-id">User ID: {{ reply.charityHubUser?.id }}</div>
              <div *ngIf="editCommentId !== reply.id" class="comment-content">{{ reply.content }}</div>
              <div *ngIf="editCommentId === reply.id" class="edit-input-section">
                <input
                  type="text"
                  [(ngModel)]="editCommentContent[reply.id]"
                  class="edit-input"
                  placeholder="Edit your reply..."
                  (keyup.enter)="updateComment(reply.id, comment.id)"
                />
                <button (click)="updateComment(reply.id, comment.id)" class="edit-save-button">Save</button>
              </div>
            </div>
            <button (click)="deleteComment(reply.id, comment.id)" class="delete-reply-button">Delete</button>
            <button *ngIf="editCommentId !== reply.id" (click)="toggleEdit(reply.id)" class="edit-button">Edit</button>
            <!-- Use 'edit-button' for consistency -->
          </div>
        </ng-container>
      </div>
    </div>
  </ng-container>

  <!-- Add new comment section -->
  <div class="new-comment-section">
    <input
      type="text"
      [(ngModel)]="newComment"
      name="newComment"
      class="new-comment-input"
      placeholder="Add a new comment..."
      (keyup.enter)="addComment()"
    />
    <button (click)="addComment()" class="add-comment-button">Add Comment</button>
  </div>
</div>
